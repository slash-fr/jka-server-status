<VirtualHost *:80>
    ServerName status.example.com
    #ServerAlias jka.example.com

    # The web root is the "public" directory
    DocumentRoot "/var/www/jka-server-status/public"
    <Directory /var/www/jka-server-status/public>
        AllowOverride None
        Require all granted
        # Redirect every request that doesn't match an existing file to "index.php"
        FallbackResource /index.php
    </Directory>

    # Enable gzip compression
    AddOutputFilterByType DEFLATE text/html text/css text/javascript application/javascript application/json image/svg+xml image/ico image/x-icon
    DeflateCompressionLevel 9
    # Don't compress formats that are already compressed, such as JPG, AVIF, PNG, ...

    <FilesMatch \.php$>
        # Make sure this matches your actual PHP-FPM socket
        SetHandler proxy:unix:/var/run/php/php-fpm.sock|fcgi://dummy

        # Force revalidation
        Header set Cache-Control "no-cache"
    </FilesMatch>

    <FilesMatch "\.(jpg|jpeg)$">
        RewriteEngine on
        # If the browser accepts AVIF images,
        RewriteCond %{HTTP_ACCEPT} image/avif
        # and the AVIF file exists (e.g. "/levelshots/mp/ffa3.jpg.avif"),
        RewriteCond %{REQUEST_FILENAME}.avif -f
        # Serve the AVIF version:
        RewriteRule ^(.+)$ $1.avif [T=image/avif]

        # Cache the image for a year
        Header set Cache-Control "public, max-age=31536000, immutable"
        # If the content of the image changes, you can use a query string for cache busting purposes (e.g. "?version=2")
        # Note: The query string will be automatically added by the asset() function (see: src/template_functions.php)

        # Don't use the cached version anymore if the "Accept" header changes (e.g. "image/avif" is added/removed)
        Header set Vary "accept"
    </FilesMatch>

    <FilesMatch "\.(css|js|png|ico|svg|webmanifest)$">
        # Cache the file for a year
        Header set Cache-Control "public, max-age=31536000, immutable"
        # If the content of the file changes, you can use a query string for cache busting purposes (e.g. "?version=2")
        # Note: The query string will be automatically added by the asset() function (see: src/template_functions.php)
    </FilesMatch>

    ErrorLog /var/log/apache2/jka-server-status_error.log
    CustomLog /var/log/apache2/jka-server-status_access.log combined
</VirtualHost>

# Don't forget to setup HTTPS (see: https://ssl-config.mozilla.org/)
# (Not shown in this sample config)
